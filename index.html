<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DE-TRUSTED ERP | Unified Admin & Finance Hub</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        
        body { 
            font-family: 'Inter', sans-serif; margin: 0; color: #1e293b;
            background: linear-gradient(135deg, #ffffff 0%, #fefce8 100%);
            background-attachment: fixed;
            background-image: url("data:image/svg+xml,%3Csvg width='300' height='300' viewBox='0 0 300 300' xmlns='http://www.w3.org/2000/svg'%3E%3Ctext x='50%25' y='50%25' font-family='Georgia' font-size='22' fill='rgba(184, 134, 11, 0.07)' text-anchor='middle' transform='rotate(-35, 150, 150)'%3EDE-TRUSTED%3C/text%3E%3C/svg%3E");
        }

        h1, h2, h3, .cambria { font-family: 'Cambria', 'Georgia', serif; }
        
        .sidebar-royal { background: #002366; min-height: 100vh; position: fixed; width: 260px; z-index: 50; box-shadow: 4px 0 10px rgba(0,0,0,0.1); }
        .nav-btn { width: 100%; text-align: left; padding: 12px 24px; font-size: 10px; letter-spacing: 0.1em; text-transform: uppercase; border-left: 4px solid transparent; transition: 0.3s; color: #94a3b8; cursor: pointer; }
        .nav-btn.active { background: #001a4d; color: #fbbf24; border-left-color: #fbbf24; font-weight: 700; }
        
        .admin-sub-card { background: rgba(255, 255, 255, 0.9); border: 1px solid #eab308; border-radius: 12px; height: calc(100vh - 180px); overflow-y: auto; }
        .branch-label { font-size: 9px; font-weight: 900; color: #002366; padding: 18px 20px 8px 20px; text-transform: uppercase; letter-spacing: 0.15em; border-top: 1px solid #fef3c7; }
        
        .sub-link { padding: 10px 24px; font-size: 11px; color: #475569; cursor: pointer; display: flex; align-items: center; border-left: 3px solid transparent; transition: 0.2s; font-weight: 500; }
        .sub-link:hover { background: #fffbeb; color: #002366; }
        .sub-link.active { background: #fef3c7; color: #002366; font-weight: 700; border-left-color: #002366; }

        .workspace-card { background: #ffffff; border-radius: 16px; border: 1px solid #eab308; padding: 2.5rem; min-height: 850px; box-shadow: 0 10px 30px -5px rgba(184, 134, 11, 0.1); }
        .field-label { font-size: 9px; font-weight: 800; text-transform: uppercase; color: #002366; margin-bottom: 6px; display: block; }
        .input-linked, .select-linked { width: 100%; background: #ffffff; border: 1px solid #e2e8f0; padding: 10px; border-radius: 6px; font-size: 13px; color: #1e293b; outline: none; border-bottom: 2px solid #eab308; transition: 0.3s; }
        .input-readonly { background: #f1f5f9; cursor: not-allowed; border-bottom: 2px solid #94a3b8; }
        
        .finance-header { background: #002366; color: #fbbf24; padding: 15px 25px; border-radius: 8px; margin-bottom: 25px; border: 1px solid #eab308; display: flex; justify-content: space-between; align-items: center; }
        .prepared-by { background: #f8fafc; padding: 15px; border-radius: 8px; border: 1px dashed #cbd5e1; margin-top: 30px; display: flex; justify-content: space-between; }
        .royal-badge { font-size: 8px; font-weight: 900; padding: 3px 10px; border-radius: 20px; background: #002366; color: #fbbf24; }
        .strat-card { border-left: 4px solid #fbbf24; background: #fffbeb; padding: 15px; margin-bottom: 12px; border-radius: 0 8px 8px 0; }
        
        .dash-stat-card { background: white; border: 1px solid #e2e8f0; padding: 1.5rem; border-radius: 12px; border-bottom: 4px solid #002366; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script>
        window.onload = function() {
            const e = React.createElement;
            const { useState, useEffect } = React;

            const GH_AGENCIES = ["GRA", "EPA", "FDA", "GSA", "SSNIT", "RGD", "GFS", "FID", "Municipal Assembly"];
            const CURRENCIES = ["GHS", "USD", "EUR", "GBP"];
            const VENDORS = ["Qualiplast Ltd", "Paints & Chemicals Ltd", "Mainland Containers", "Ghana Water Co", "ECG", "Custom Packaging"];

            const SYSTEM_REGISTRY = {
                // --- ADMINISTRATION DESK: ALL RESTORED FEATURES ---
                "Department Purpose": { desk: "Administration", isWelcome: true },
                "Regulatory Master": { desk: "Administration", title: "Regulatory Agency Master", table: "regulatory_bodies", fields: ["Agency Name", "Contact Person Name", "Phone Number", "Rank/Designation", "Primary Email", "Office Location", "GPS Address", "Governing Act", "Remarks"] },
                "Statutory Setup": { desk: "Administration", title: "Statutory Requirements Master", table: "statutory_requirements", fields: ["Agency Name", "Requirement Name", "Reference No.", "Legal Reference Code", "Renewal Cycle", "Remarks"] },
                "Permit Register": { desk: "Administration", title: "Live License & Permit Register", table: "licenses_permits", fields: ["Agency Name", "Reference No.", "Permit Serial #", "Issue Date", "Expiry Date", "Department Lead", "GPS Address", "Remarks"] },
                "Corporate Assets": { desk: "Administration", title: "Fixed Asset Registry", table: "corporate_assets", fields: ["Asset Category", "Asset Description", "Serial Number", "Purchase Date", "Current Location", "Assigned Staff", "Asset Condition", "Remarks"] },
                "Insurance & Liabilities": { desk: "Administration", title: "Insurance & Policy Tracking", table: "insurance_logs", fields: ["Policy Provider", "Policy Number", "Type", "Effective Date", "Expiry Date", "Premium Amount", "Reference No.", "Remarks"] },
                "Renewal Transaction": { desk: "Administration", title: "Permit Renewal Workflow", table: "renewals", fields: ["Agency Name", "Reference No.", "Current Permit #", "Last Renewal Date", "Next Expiry Date", "Renewal Status", "Remarks"] },
                "Site Inspections": { desk: "Administration", title: "Regulatory Inspection Log", table: "inspections", fields: ["Agency Name", "Reference No.", "Inspection Type", "Inspectors Present", "Contact Phone", "GPS Address", "Compliance Finding", "Remarks"] },
                "Compliance Breaches": { desk: "Administration", title: "Incident & Breach Registry", table: "compliance_incidents", fields: ["Agency Name", "Reference No.", "Incident Date", "Root Cause Analysis", "Immediate Mitigation", "Closure Ref", "Remarks"] },
                
                // --- FINANCE DESK: ALL RESTORED FEATURES ---
                "Accounts Payable": { 
                    desk: "Finance", 
                    title: "Accounts Payable (AP) Master", 
                    table: "finance_ap", 
                    fields: [
                        "Invoice ID (Auto)", "Supplier (Dropdown)", "Invoice Date", "Invoice Number", 
                        "Currency", "Base Amount", "Tax / VAT (15%)", "Total Amount Payable", 
                        "Payment Terms", "Due Date", "Payment Status", "Payment Method", 
                        "Approved By", "Notes"
                    ] 
                },
                "General Ledger": { desk: "Finance", title: "General Ledger Entry Console", table: "finance_gl", fields: ["Entry ID", "Transaction Date", "Transaction Type", "Account Code (CoA)", "Account Name", "Debit Amount", "Credit Amount", "Currency", "Exchange Rate", "Reference No.", "Status", "Description"] },
                "Import Costing": { desk: "Finance", title: "Duty & Landed Cost Breakdown", table: "import_costing", fields: ["Import ID (Ref)", "FOB Value", "Freight Cost", "Insurance Cost", "Import Duty (GRA)", "VAT", "NHIL / GETFund Levy", "Processing Fees", "Total Landed Cost", "Cost Allocation Method"] }
            };

            function DeskRenderer({ activeSub, setActiveSub, currentDesk }) {
                const schema = SYSTEM_REGISTRY[activeSub] || { isWelcome: true };
                const [form, setForm] = useState({});

                // Automated Logic for AP Calculations
                useEffect(() => {
                    if (activeSub === "Accounts Payable") {
                        const base = parseFloat(form["Base Amount"]) || 0;
                        const tax = base * 0.15;
                        const total = base + tax;
                        
                        let dueDate = form["Due Date"];
                        if (form["Invoice Date"] && form["Payment Terms"]) {
                            const dateObj = new Date(form["Invoice Date"]);
                            const days = parseInt(form["Payment Terms"]);
                            dateObj.setDate(dateObj.getDate() + days);
                            dueDate = dateObj.toISOString().split('T')[0];
                        }
                        
                        if (tax.toFixed(2) !== form["Tax / VAT (15%)"] || dueDate !== form["Due Date"]) {
                            setForm(prev => ({ ...prev, "Tax / VAT (15%)": tax.toFixed(2), "Total Amount Payable": total.toFixed(2), "Due Date": dueDate }));
                        }
                    }
                }, [form["Base Amount"], form["Invoice Date"], form["Payment Terms"], activeSub]);

                const renderField = (label) => {
                    const isReadOnly = ["Invoice ID (Auto)", "Tax / VAT (15%)", "Total Amount Payable", "Due Date"].includes(label);
                    const isSelect = label.includes("Agency") || label.includes("Dropdown") || label.includes("Status") || label.includes("Method") || label.includes("Terms") || label === "Currency";
                    const isFull = label === "Remarks" || label === "Notes" || label === "Description" || label.includes("Analysis") || label === "Compliance Finding";

                    return e('div', { key: label, className: isFull ? "col-span-2" : "" },
                        e('label', { className: 'field-label' }, label),
                        isSelect ? 
                            e('select', { className: 'select-linked', value: form[label] || '', onChange: (x) => setForm({...form, [label]: x.target.value}) }, 
                                e('option', { value: '' }, `-- Select ${label} --`),
                                label.includes("Agency") ? GH_AGENCIES.map(a => e('option', {key:a}, a)) :
                                label === "Supplier (Dropdown)" ? VENDORS.map(v => e('option', {key:v}, v)) :
                                label === "Payment Terms" ? ["30", "60", "90"].map(t => e('option', {key:t, value:t}, `${t} days`)) :
                                ["Pending", "Paid", "Active", "Draft"].map(o => e('option', {key:o}, o))
                            ) :
                        e(isFull ? 'textarea' : 'input', { 
                            className: `input-linked ${isReadOnly ? 'input-readonly' : ''} ${isFull ? 'h-24' : ''}`, 
                            readOnly: isReadOnly,
                            type: label.includes("Date") ? "date" : label.includes("Amount") || label === "Base Amount" ? "number" : "text",
                            value: form[label] || (label === "Invoice ID (Auto)" ? "INV-"+Date.now().toString().slice(-5) : ""),
                            onChange: (x) => setForm({...form, [label]: x.target.value})
                        })
                    );
                };

                if (currentDesk === 'Executive') {
                    return e('div', { className: 'fade-in' },
                        e('h1', { className: 'text-3xl cambria text-blue-900 font-bold mb-8' }, 'Executive Overview'),
                        e('div', { className: 'grid grid-cols-3 gap-6 mb-12' },
                            e('div', { className: 'dash-stat-card' }, e('p', {className:'text-[10px] font-bold text-slate-400 uppercase'}, 'Pending AP'), e('h2', {className:'text-3xl font-black text-red-600'}, 'GHS 84,200')),
                            e('div', { className: 'dash-stat-card' }, e('p', {className:'text-[10px] font-bold text-slate-400 uppercase'}, 'Regulatory Compliance'), e('h2', {className:'text-3xl font-black text-blue-900'}, '92%')),
                            e('div', { className: 'dash-stat-card' }, e('p', {className:'text-[10px] font-bold text-slate-400 uppercase'}, 'Active Permits'), e('h2', {className:'text-3xl font-black text-amber-600'}, '12'))
                        ),
                        e('div', { className: 'workspace-card' }, 
                             e('h2', { className: 'text-lg font-bold text-blue-900 mb-4' }, 'System Alerts'),
                             e('div', { className: 'strat-card' }, 'Administration: 2 EPA Permits require renewal data entry.'),
                             e('div', { className: 'strat-card' }, 'Finance: Accounts Payable aging report updated.')
                        )
                    );
                }

                return e('div', { className: 'fade-in' },
                    e('div', { className: 'mb-8 border-b-2 border-amber-200 pb-6 flex justify-between items-end' },
                        e('div', null, 
                            e('h1', { className: 'text-3xl cambria text-blue-900 font-bold' }, `${currentDesk} Desk`),
                            e('p', { className: 'text-blue-700 text-sm font-medium' }, `DE-TRUSTED | 2025 MASTER COMMAND`)
                        ),
                        e('div', { className: 'flex gap-2' }, e('span', { className: 'royal-badge' }, 'AUTH: EXECUTIVE'), e('span', { className: 'royal-badge' }, 'LIVE_SYNC_ON'))
                    ),
                    e('div', { className: 'grid grid-cols-12 gap-8' },
                        e('div', { className: 'col-span-3' },
                            e('div', { className: 'admin-sub-card shadow-lg' },
                                e('div', { className: 'branch-label' }, 'Module Nav'),
                                Object.keys(SYSTEM_REGISTRY).filter(k => SYSTEM_REGISTRY[k].desk === currentDesk).map(name => 
                                    e('div', { 
                                        key: name, 
                                        className: `sub-link ${activeSub === name ? 'active' : ''}`,
                                        onClick: () => { setActiveSub(name); setForm({}); }
                                    }, name)
                                )
                            )
                        ),
                        e('div', { className: 'col-span-9' },
                            e('div', { className: 'workspace-card fade-in', key: activeSub },
                                schema.isWelcome ? e('div', null,
                                    e('h2', { className: 'text-[10px] font-black text-blue-900 uppercase tracking-widest mb-4' }, 'Operational Status'),
                                    e('p', { className: 'intro-text mb-8' }, "Welcome to the De-Trusted Paint Manufacturing control center. All modules for regulatory tracking and financial integrity are active."),
                                    e('div', { className: 'strat-card shadow-sm' }, e('h4', { className: 'font-bold text-blue-900 text-sm' }, 'Administration & Compliance Modules Locked and Loaded')),
                                    e('div', { className: 'strat-card shadow-sm' }, e('h4', { className: 'font-bold text-blue-900 text-sm' }, 'Finance & Accounts Payable Logic Synchronized'))
                                ) : e('div', null,
                                    currentDesk === 'Finance' && e('div', { className: 'finance-header' }, 
                                        e('div', null, e('p', { className: 'text-[9px] uppercase' }, 'Accounts Payable Engine'), e('p', { className: 'text-xl font-black' }, 'LIABILITY MASTER')),
                                        e('div', { className: 'text-right' }, e('p', { className: 'text-[9px] uppercase' }, 'Reference'), e('p', { className: 'text-xl font-black' }, 'AP-GEN-2025'))
                                    ),
                                    e('div', { className: 'flex justify-between items-start mb-10' },
                                        e('div', null, e('h2', { className: 'text-2xl font-bold text-blue-900' }, schema.title), e('p', { className: 'text-[9px] font-black text-amber-600 uppercase mt-2' }, `DATABASE: ${schema.table}`)),
                                        e('button', { className: 'bg-blue-900 text-white text-[9px] font-bold uppercase px-8 py-3 rounded-md shadow-xl' }, 'Post Record')
                                    ),
                                    e('div', { className: 'grid grid-cols-2 gap-x-10 gap-y-6' }, schema.fields.map(renderField)),
                                    e('div', { className: 'prepared-by' },
                                        e('div', null, e('p', { className: 'text-[9px] font-bold text-slate-400' }, 'AUTHENTICATED BY'), e('p', { className: 'text-[12px] font-bold text-blue-900' }, 'Executive Admin')),
                                        e('div', { className: 'text-right' }, e('p', { className: 'text-[9px] font-bold text-slate-400' }, 'SYSTEM TIMESTAMP'), e('p', { className: 'text-[12px] font-bold text-blue-900' }, '2025-12-30 | 14:24 GMT'))
                                    )
                                )
                            )
                        )
                    )
                );
            }

            function App() {
                const [currentDesk, setCurrentDesk] = useState('Executive');
                const [activeSub, setActiveSub] = useState('Executive');
                const desks = ['Executive', 'Administration', 'Finance', 'Logistics', 'Procurement', 'Production', 'Sales', 'Warehouse', 'HR', 'Reception'];

                return e('div', { className: 'flex' },
                    e('div', { className: 'sidebar-royal' },
                        e('div', { className: 'p-8 mb-6 border-b border-blue-800' }, e('h1', { className: 'cambria text-white text-2xl font-bold' }, 'DE-TRUSTED')),
                        desks.map(name => e('button', { 
                            key: name, 
                            onClick: () => { 
                                setCurrentDesk(name); 
                                const firstSub = Object.keys(SYSTEM_REGISTRY).find(k => SYSTEM_REGISTRY[k].desk === name);
                                setActiveSub(firstSub || name);
                            }, 
                            className: `nav-btn ${currentDesk === name ? 'active' : ''}` 
                        }, name))
                    ),
                    e('main', { className: 'flex-1 ml-[260px] min-h-screen p-16' },
                        e(DeskRenderer, { activeSub, setActiveSub, currentDesk })
                    )
                );
            }

            const root = ReactDOM.createRoot(document.getElementById('root'));
            root.render(e(App));
        };
    </script>
</body>
</html>
