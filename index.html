<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DE-TRUSTED ERP | FINAL AUTH & HISTORY</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;700&family=Roboto+Mono&display=swap');
        body { font-family: 'Ubuntu', sans-serif; background: #020617; color: #f8fafc; margin: 0; }
        .sidebar { background: #0f172a; border-right: 1px solid #1e293b; height: 100vh; width: 260px; position: fixed; z-index: 10; }
        .main-content { margin-left: 260px; min-height: 100vh; padding: 40px; }
        .glass-card { background: #1e293b; border: 1px solid #334155; border-radius: 12px; padding: 25px; }
        .input-box { background: #020617; border: 1px solid #475569; color: white; padding: 12px; border-radius: 6px; width: 100%; margin-top: 5px; font-family: 'Roboto Mono', monospace; outline: none; }
        .input-box:focus { border-color: #fbbf24; }
        .btn-gold { background: #fbbf24; color: #020617; font-weight: 900; padding: 14px; border-radius: 6px; width: 100%; cursor: pointer; border: none; text-transform: uppercase; transition: 0.3s; }
        .btn-gold:hover { background: #fcd34d; }
        .history-table { width: 100%; border-collapse: collapse; margin-top: 20px; font-size: 13px; }
        .history-table th { text-align: left; padding: 12px; border-bottom: 2px solid #334155; color: #94a3b8; }
        .history-table td { padding: 12px; border-bottom: 1px solid #1e293b; }
        .mono { font-family: 'Roboto Mono', monospace; }
        .toggle-btn { padding: 6px 12px; font-size: 10px; font-weight: 800; border-radius: 4px; cursor: pointer; }
    </style>
</head>
<body>
    <div id="root"></div>
    <script>
        window.onload = function() {
            const e = React.createElement;
            const { useState } = React;

            const fmt = (num) => new Intl.NumberFormat('en-GH', { minimumFractionDigits: 2, maximumFractionDigits: 2 }).format(num);

            function App() {
                const [isAuth, setIsAuth] = useState(false);
                const [passInput, setPassInput] = useState('');
                
                const [empName, setEmpName] = useState('');
                const [basicSalary, setBasicSalary] = useState(0);
                const [bonus, setBonus] = useState(0);
                const [loan, setLoan] = useState(0);
                const [isBonusTaxable, setIsBonusTaxable] = useState(true);
                
                // DATA STORAGE
                const [history, setHistory] = useState([]);

                // --- CALCULATION LOGIC ---
                const taxableBonus = isBonusTaxable ? bonus : 0;
                const untaxedBonus = isBonusTaxable ? 0 : bonus;
                const ssnit = (basicSalary + taxableBonus) * 0.055;
                const taxableIncome = (basicSalary + taxableBonus) - ssnit;

                const calculatePAYE = (income) => {
                    let tax = 0; let rem = income;
                    const bands = [
                        { a: 490, r: 0.00 }, { a: 110, r: 0.05 }, { a: 130, r: 0.10 },
                        { a: 3167, r: 0.175 }, { a: 16103, r: 0.25 }, { a: Infinity, r: 0.30 }
                    ];
                    for (let b of bands) {
                        if (rem <= 0) break;
                        let chunk = Math.min(rem, b.a);
                        tax += chunk * b.r;
                        rem -= chunk;
                    }
                    return tax;
                };

                const payeTax = calculatePAYE(taxableIncome);
                const netPay = (taxableIncome - payeTax) + untaxedBonus - loan;

                const handleLogin = (val) => {
                    val.preventDefault();
                    if (passInput === 'SUPER2025') {
                        setIsAuth(true);
                    } else {
                        alert("DENIED: Incorrect Key.");
                    }
                };

                const saveToHistory = () => {
                    if (!empName) return alert("Please enter staff name");
                    const record = {
                        id: Date.now(),
                        name: empName,
                        date: new Date().toLocaleDateString(),
                        gross: basicSalary + bonus,
                        net: netPay
                    };
                    setHistory([record, ...history]);
                    alert("Payroll Record Saved to History!");
                };

                if (!isAuth) {
                    return e('div', { className: 'h-screen w-full flex items-center justify-center bg-slate-950' },
                        e('form', { onSubmit: handleLogin, className: 'glass-card w-96 text-center' },
                            e('h1', { className: 'text-2xl font-black mb-2 text-white' }, 'DE-TRUSTED ERP'),
                            e('p', { className: 'text-[10px] text-yellow-500 font-bold mb-8' }, 'VERIFY MASTER ACCESS'),
                            e('input', { 
                                type: 'password', 
                                className: 'input-box text-center mb-6 border-slate-700', 
                                placeholder: 'PASSKEY', 
                                value: passInput, 
                                onChange: (v) => setPassInput(v.target.value)
                            }),
                            e('button', { type: 'submit', className: 'btn-gold' }, 'LOG IN')
                        )
                    );
                }

                return e('div', { className: 'flex' },
                    e('aside', { className: 'sidebar' },
                        e('div', { className: 'p-8 border-b border-slate-800' }, e('h1', { className: 'text-xl font-black italic text-white' }, 'DE-TRUSTED')),
                        e('nav', { className: 'mt-4' }, e('div', { className: 'nav-link active' }, 'ðŸ‘¥ Payroll Desk'))
                    ),
                    e('main', { className: 'main-content flex-1' },
                        e('div', { className: 'flex justify-between items-center mb-10' },
                            e('h2', { className: 'text-3xl font-black text-white' }, 'Payroll Processor'),
                            e('button', { onClick: () => window.location.reload(), className: 'text-[10px] text-red-500 border border-red-500 px-3 py-1 rounded font-bold' }, 'LOCK EXIT')
                        ),
                        
                        e('div', { className: 'grid grid-cols-1 lg:grid-cols-2 gap-8 mb-10' },
                            e('div', { className: 'glass-card space-y-4' },
                                e('div', null, e('label', {className:'text-[10px] text-slate-500 font-bold'}, 'STAFF NAME'), e('input', {className:'input-box text-sm', value:empName, onChange:v=>setEmpName(v.target.value)})),
                                e('div', null, e('label', {className:'text-[10px] text-slate-500 font-bold'}, 'BASIC SALARY'), e('input', {type:'number', className:'input-box text-yellow-500', value:basicSalary, onChange:v=>setBasicSalary(parseFloat(v.target.value)||0)})),
                                e('div', null, 
                                    e('div', {className:'flex justify-between mb-1'}, e('label', {className:'text-[10px] text-slate-500 font-bold'}, 'ALLOWANCE'),
                                        e('div', {className:'flex gap-1'}, 
                                            e('button', { onClick:()=>setIsBonusTaxable(true), className: `toggle-btn ${isBonusTaxable ? 'bg-yellow-500 text-black' : 'bg-slate-800'}` }, 'TAX'),
                                            e('button', { onClick:()=>setIsBonusTaxable(false), className: `toggle-btn ${!isBonusTaxable ? 'bg-emerald-500 text-black' : 'bg-slate-800'}` }, 'EXEMPT')
                                        )
                                    ),
                                    e('input', {type:'number', className:'input-box', value:bonus, onChange:v=>setBonus(parseFloat(v.target.value)||0)})
                                ),
                                e('div', null, e('label', {className:'text-[10px] text-red-400 font-bold'}, 'LOAN DEDUCTION'), e('input', {type:'number', className:'input-box text-red-400', value:loan, onChange:v=>setLoan(parseFloat(v.target.value)||0)})),
                                e('div', {className:'pt-4'}, e('button', {className:'btn-gold', onClick: saveToHistory}, 'Process & Save Record'))
                            ),
                            
                            e('div', { className: 'glass-card bg-slate-900/40' },
                                e('h3', { className: 'text-xs font-bold text-slate-500 mb-8 uppercase' }, 'Computation Summary'),
                                e('div', { className: 'space-y-4 mono text-sm' },
                                    e('div', { className: 'flex justify-between' }, e('span', null, 'Gross Income'), e('span', null, fmt(basicSalary + bonus))),
                                    e('div', { className: 'flex justify-between text-red-400' }, e('span', null, 'SSNIT (5.5%)'), e('span', null, `-${fmt(ssnit)}`)),
                                    e('div', { className: 'flex justify-between text-red-400' }, e('span', null, 'PAYE Tax'), e('span', null, `-${fmt(payeTax)}`)),
                                    e('div', { className: 'flex justify-between text-orange-400' }, e('span', null, 'Loan Recovery'), e('span', null, `-${fmt(loan)}`)),
                                    e('div', { className: 'flex justify-between pt-6 border-t border-yellow-500' }, 
                                        e('span', { className: 'text-emerald-500 font-bold' }, 'NET PAYABLE'),
                                        e('span', { className: 'text-emerald-500 font-black text-2xl' }, `GHS ${fmt(netPay)}`)
                                    )
                                )
                            )
                        ),

                        e('div', { className: 'glass-card' },
                            e('h3', { className: 'text-xs font-bold text-slate-500 uppercase mb-4' }, 'Recent Payroll History'),
                            e('table', { className: 'history-table' },
                                e('thead', null, e('tr', null, e('th', null, 'STAFF'), e('th', null, 'DATE'), e('th', null, 'GROSS'), e('th', null, 'NET PAY'))),
                                e('tbody', null, history.map(h => e('tr', { key: h.id },
                                    e('td', {className:'font-bold'}, h.name),
                                    e('td', {className:'text-slate-500'}, h.date),
                                    e('td', null, fmt(h.gross)),
                                    e('td', {className:'text-emerald-500 font-bold'}, fmt(h.net))
                                )))
                            ),
                            history.length === 0 && e('p', {className:'text-center text-slate-600 mt-6 text-xs'}, 'No records processed yet.')
                        )
                    )
                );
            }
            ReactDOM.createRoot(document.getElementById('root')).render(e(App));
        };
    </script>
</body>
</html>
